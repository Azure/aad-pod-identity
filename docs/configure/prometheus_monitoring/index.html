<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.75.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/aad-pod-identity/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/aad-pod-identity/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/aad-pod-identity/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/aad-pod-identity/favicons/android-192x192.png sizes=192x192><title>Monitoring Pod Identity with Prometheus | Azure Active Directory Pod Identity for Kubernetes</title><meta property="og:title" content="Monitoring Pod Identity with Prometheus"><meta property="og:description" content="Prometheus is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions,displays the results, and can trigger alerts if some condition is observed to be true."><meta property="og:type" content="article"><meta property="og:url" content="https://azure.github.io/aad-pod-identity/docs/configure/prometheus_monitoring/"><meta property="article:modified_time" content="2020-10-12T15:32:04-07:00"><meta property="og:site_name" content="Azure Active Directory Pod Identity for Kubernetes"><meta itemprop=name content="Monitoring Pod Identity with Prometheus"><meta itemprop=description content="Prometheus is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions,displays the results, and can trigger alerts if some condition is observed to be true."><meta itemprop=dateModified content="2020-10-12T15:32:04-07:00"><meta itemprop=wordCount content="350"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Monitoring Pod Identity with Prometheus"><meta name=twitter:description content="Prometheus is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions,displays the results, and can trigger alerts if some condition is observed to be true."><link rel=preload href=/aad-pod-identity/scss/main.min.3ea58881782e4ff269e483a54676729c31b63711f1f727ae2946b23cf8ff2572.css as=style><link href=/aad-pod-identity/scss/main.min.3ea58881782e4ff269e483a54676729c31b63711f1f727ae2946b23cf8ff2572.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/aad-pod-identity/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Azure Active Directory Pod Identity for Kubernetes</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/aad-pod-identity/changelog/><span>Changelog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/aad-pod-identity/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/Azure/aad-pod-identity target=_blank><span>GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/aad-pod-identity/offline-search-index.e0c12102008ca089da57189db36d115d3361f62c2923ea8af969d06052811b42bf503609fa9ee61d85cab1580d38868111601f77475e0adf5ff0ac0dc7d43fbe.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/aad-pod-identity/offline-search-index.e0c12102008ca089da57189db36d115d3361f62c2923ea8af969d06052811b42bf503609fa9ee61d85cab1580d38868111601f77475e0adf5ff0ac0dc7d43fbe.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a></li><ul><li class="collapse show" id=aad-pod-identitydocs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/getting-started/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a></li><ul><li class=collapse id=aad-pod-identitydocsgetting-started><a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsgetting-startedrole-assignment href=/aad-pod-identity/docs/getting-started/role-assignment/>Role Assignment</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsgetting-startedinstallation href=/aad-pod-identity/docs/getting-started/installation/>Installation</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/concepts/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a></li><ul><li class=collapse id=aad-pod-identitydocsconcepts><a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsazureidentity href=/aad-pod-identity/docs/concepts/azureidentity/>AzureIdentity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsazureidentitybinding href=/aad-pod-identity/docs/concepts/azureidentitybinding/>AzureIdentityBinding</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsazureassignedidentity href=/aad-pod-identity/docs/concepts/azureassignedidentity/>AzureAssignedIdentity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsazurepodidentityexception href=/aad-pod-identity/docs/concepts/azurepodidentityexception/>AzurePodIdentityException</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsmic href=/aad-pod-identity/docs/concepts/mic/>Managed Identity Controller (MIC)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsnmi href=/aad-pod-identity/docs/concepts/nmi/>Node Managed Identity (NMI)</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconceptsblock-diagram-and-design href=/aad-pod-identity/docs/concepts/block-diagram-and-design/>Block Diagram and Design</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/demo/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Demos</a></li><ul><li class=collapse id=aad-pod-identitydocsdemo><a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsdemostandard_walkthrough href=/aad-pod-identity/docs/demo/standard_walkthrough/>Standard Walkthrough</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsdemotutorial href=/aad-pod-identity/docs/demo/tutorial/>AAD Pod Identity Tutorial</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsdemojava-blob href=/aad-pod-identity/docs/demo/java-blob/>Spring Boot + Azure Storage + AAD Pod Identity</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsdemoquickstart href=/aad-pod-identity/docs/demo/quickstart/>Quickstart Demo</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/configure/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Configurations</a></li><ul><li class="collapse show" id=aad-pod-identitydocsconfigure><a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigurematch_pods_in_namespace href=/aad-pod-identity/docs/configure/match_pods_in_namespace/>Match Pods in the Namespace</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigureaad_pod_identity_on_kubenet href=/aad-pod-identity/docs/configure/aad_pod_identity_on_kubenet/>Deploy AAD Pod Identity in a Cluster with Kubenet</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfiguredeploy_aad_pod_dedicated_sp href=/aad-pod-identity/docs/configure/deploy_aad_pod_dedicated_sp/>Deploy AAD Pod Identity with a Dedicated Service Principal</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigureapplication_exception href=/aad-pod-identity/docs/configure/application_exception/>Disable AAD Pod Identity for a specific Pod/Application</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigureazure_identity_validation href=/aad-pod-identity/docs/configure/azure_identity_validation/>Azure Identity Validation using Gatekeeper</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigurefeature_flags href=/aad-pod-identity/docs/configure/feature_flags/>Feature Flags</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigurecustom_cloud href=/aad-pod-identity/docs/configure/custom_cloud/>Pod Identity in Custom Cloud</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigurepod_identity_in_managed_mode href=/aad-pod-identity/docs/configure/pod_identity_in_managed_mode/>Pod Identity in Managed Mode</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-aad-pod-identitydocsconfigureprometheus_monitoring href=/aad-pod-identity/docs/configure/prometheus_monitoring/>Monitoring Pod Identity with Prometheus</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-aad-pod-identitydocsconfigureenable_psp_enabled_clusters href=/aad-pod-identity/docs/configure/enable_psp_enabled_clusters/>Enable PSP Clusters</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/best-practices/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Best Practices</a></li><ul><li class=collapse id=aad-pod-identitydocsbest-practices></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/known-issues/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Known Issues</a></li><ul><li class=collapse id=aad-pod-identitydocsknown-issues></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/contributing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contributing</a></li><ul><li class=collapse id=aad-pod-identitydocscontributing></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/troubleshooting/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Troubleshooting</a></li><ul><li class=collapse id=aad-pod-identitydocstroubleshooting></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/support/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Support</a></li><ul><li class=collapse id=aad-pod-identitydocssupport></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/aad-pod-identity/docs/code-of-conduct/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Code of Conduct</a></li><ul><li class=collapse id=aad-pod-identitydocscode-of-conduct></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/Azure/aad-pod-identity/edit/master/website/content/en/docs/Configure/prometheus_monitoring.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/Azure/aad-pod-identity/issues/new?title=Monitoring%20Pod%20Identity%20with%20Prometheus" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href="https://github.com/Azure/aad-pod-identity/issues/new?assignees=&labels=bug&template=bug_report.md&title=/issues/new" target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#liveliness-probe>Liveliness Probe</a></li><li><a href=#prometheus-metrics>Prometheus Metrics</a><ul><li><a href=#prometheus-metrics-endpoints>Prometheus Metrics Endpoints</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://azure.github.io/aad-pod-identity/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://azure.github.io/aad-pod-identity/docs/configure/>Configurations</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://azure.github.io/aad-pod-identity/docs/configure/prometheus_monitoring/>Monitoring Pod Identity with Prometheus</a></li></ol></nav><div class=td-content><h1>Monitoring Pod Identity with Prometheus</h1><div class=lead>Prometheus is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions,displays the results, and can trigger alerts if some condition is observed to be true.</div><h2 id=introduction>Introduction</h2><p>AAD pod identity is a foundational service that other applications depend upon, it is recommended to monitor the same.</p><p>Liveliness probe and Prometheus metrics are available in both Managed Identity Controller (MIC) and the Node Managed Identity (NMI) components.</p><h2 id=liveliness-probe>Liveliness Probe</h2><p>MIC and NMI exposes /healthz endpoint with content of &ldquo;Active/Not Active&rdquo; state.
State &ldquo;Active&rdquo; is being returned if the component has started successfully and &ldquo;Not Active&rdquo; otherwise.</p><h2 id=prometheus-metrics>Prometheus Metrics</h2><p><a href=https://github.com/prometheus/prometheus>Prometheus</a> is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions,displays the results, and can trigger alerts if some condition is observed to be true.</p><p>The following <a href=https://opencensus.io/>OpenCensus</a> metrics are exposed in AAD pod identity system via prometheus exporter.</p><p><strong>1. aadpodidentity_assigned_identity_addition_duration_seconds</strong></p><p>Histogram that tracks the duration (in seconds) it takes for Assigned identity addition operations.</p><p><strong>2. aadpodidentity_assigned_identity_addition_count</strong></p><p>Counter that tracks the cumulative number of assigned identity addition operations.</p><p><strong>3. aadpodidentity_assigned_identity_deletion_duration_seconds</strong></p><p>Histogram that tracks the duration (in seconds) it takes for Assigned identity deletion operations.</p><p><strong>4. aadpodidentity_assigned_identity_deletion_count</strong></p><p>Counter that tracks the cumulative number of assigned identity deletion operations.</p><p><strong>5. aadpodidentity_nmi_operations_duration_seconds</strong></p><p>Histogram that tracks the latency (in seconds) of NMI operations to complete. Broken down by operation type, status code.</p><p><strong>6. aadpodidentity_mic_cycle_duration_seconds</strong></p><p>Histogram that tracks the duration (in seconds) it takes for a single cycle in MIC.</p><p><strong>7. aadpodidentity_mic_cycle_count</strong></p><p>Counter that tracks the number of cycles executed in MIC.</p><p><strong>8. aadpodidentity_mic_new_leader_election_count</strong></p><p>Counter that tracks the cumulative number of new leader election in MIC.</p><p><strong>9. aadpodidentity_cloud_provider_operations_errors_count</strong></p><p>Counter that tracks the cumulative number of cloud provider operations errors. Broken down by operation type.</p><p><strong>10. aadpodidentity_cloud_provider_operations_duration_seconds</strong></p><p>Histogram that tracks the duration (in seconds) it takes for cloud provider operations. Broken down by operation type.</p><p><strong>11. aadpodidentity_kubernetes_api_operations_errors_count</strong></p><p>Counter that tracks the cumulative number of kubernetes api operations errors. Broken down by operation type.</p><p><strong>12. aadpodidentity_imds_operations_errors_count</strong></p><p>Counter that tracks the cumulative number of imds token operation errors. Broken down by operation type.</p><p><strong>13. aadpodidentity_imds_operations_duration_seconds</strong></p><p>Histogram that tracks the duration (in seconds) it takes for IMDS token operations. Broken down by operation type.</p><h3 id=prometheus-metrics-endpoints>Prometheus Metrics Endpoints</h3><table><thead><tr><th style=text-align:center>Component</th><th>Default Metric Port</th><th>Metric Path</th></tr></thead><tbody><tr><td style=text-align:center><code>NMI</code></td><td><code>9090</code></td><td><code>/metrics</code></td></tr><tr><td style=text-align:center><code>MIC</code></td><td><code>8888</code></td><td><code>/metrics</code></td></tr></tbody></table><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/Azure/aad-pod-identity/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/Azure/aad-pod-identity/issues/new>tell us how we can improve</a>.</p><script>const yesButton=document.querySelector('.feedback--answer-yes');const noButton=document.querySelector('.feedback--answer-no');const yesResponse=document.querySelector('.feedback--response-yes');const noResponse=document.querySelector('.feedback--response-no');const disableButtons=()=>{yesButton.disabled=true;noButton.disabled=true;};const sendFeedback=(value)=>{if(typeof ga!=='function')return;const args={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:value};ga(args.command,args.hitType,args.category,args.action,args.label,args.value);};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(1);});noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(0);});</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified October 12, 2020: <a href=https://github.com/Azure/aad-pod-identity/commit/55ba979cd46b2403905393362cc58862c6296a3f>docs: update website theme to docsy (#828) (55ba979)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/Azure/aad-pod-identity><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Azure Compute OSS Upstream Team All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/aad-pod-identity/js/main.min.664f21bf5eb0c31ebc661e2616e6c63e0448cec6d5636d869957be423c3cb952.js integrity="sha256-Zk8hv16wwx68Zh4mFubGPgRIzsbVY22GmVe+Qjw8uVI=" crossorigin=anonymous></script></body></html>